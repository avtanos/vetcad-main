# Реализация AI Ассистента VetCard

## Обзор

Реализован полнофункциональный AI ассистент на основе llama3.2 для помощи владельцам питомцев с вопросами о здоровье, уходе, питании и поведении животных.

## Архитектура

### Backend компоненты

1. **AI Service** (`app/services/ai_service.py`)
   - Интеграция с Ollama для работы с llama3.2
   - Построение контекста о питомцах пользователя
   - Обработка истории разговора
   - Предложение создания напоминаний

2. **Pet Tools** (`app/services/pet_tools.py`)
   - Анализ здоровья питомцев
   - График прививок
   - Рекомендации по кормлению
   - Предложения напоминаний

3. **Chat Router** (`app/routers/chat.py`)
   - API эндпоинт для чата
   - Интеграция с аутентификацией
   - Получение данных о питомцах

### Frontend компоненты

1. **Chat Component** (`features/chat-with-ai/ui/Chat.tsx`)
   - Обновлен для использования реального API
   - Поддержка истории разговора
   - Обработка ошибок

## API Эндпоинты

### POST /api/v1/ai/chat/

Отправка сообщения в AI ассистент.

**Запрос:**
```json
{
  "message": "Какой корм лучше для щенка?",
  "conversation_history": [
    {"text": "Привет", "sender": "user"},
    {"text": "Здравствуйте!", "sender": "ai"}
  ]
}
```

**Ответ:**
```json
{
  "response": "Ответ AI ассистента...",
  "reminder_suggestion": {
    "event": "Плановый осмотр",
    "pet_name": "Рекс"
  }
}
```

## Функциональность

### 1. Персонализированные ответы

AI использует информацию о питомцах пользователя для персонализированных рекомендаций:
- Имя, вид, порода питомца
- Возраст (на основе даты рождения)
- Вес
- Особые пометки

### 2. Инструменты для питомцев

- **Анализ здоровья**: Анализ данных о питомце и выдача рекомендаций
- **График прививок**: Рекомендации по вакцинации в зависимости от вида
- **Кормление**: Рекомендации по режиму кормления
- **Напоминания**: Автоматическое предложение создания напоминаний

### 3. Умные напоминания

AI анализирует сообщения пользователя и предлагает создать напоминания для:
- Прививок и вакцинаций
- Визитов к ветеринару
- Приема лекарств
- Кормления

### 4. Fallback режим

Если Ollama не установлен или недоступен, система использует шаблонные ответы на частые вопросы.

## Установка и настройка

### 1. Установка Ollama

См. `AI_SETUP.md` для подробных инструкций.

### 2. Установка модели

```bash
ollama pull llama3.2
```

### 3. Установка зависимостей Python

```bash
pip install -r requirements.txt
```

## Использование

### Через API

```bash
curl -X POST "http://localhost:8000/api/v1/ai/chat/" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "message": "Какой корм лучше для щенка?",
    "conversation_history": []
  }'
```

### Через фронтенд

Откройте страницу "AI Ассистент" в приложении и начните диалог.

## Безопасность

- Все запросы требуют аутентификации (JWT токен)
- Контекст о питомцах доступен только авторизованным пользователям
- История разговора хранится только на клиенте

## Производительность

- Использование Ollama для локальной обработки (приватность данных)
- Поддержка истории разговора для контекстных ответов
- Fallback режим при недоступности AI

## Расширение функциональности

### Добавление новых инструментов

1. Создайте функцию в `pet_tools.py`
2. Добавьте вызов в `ai_service.py`
3. Обновите системный промпт для использования нового инструмента

### Изменение модели

Измените в `ai_service.py`:
```python
ai_service = AIService(model_name="новая_модель")
```

Затем установите модель:
```bash
ollama pull новая_модель
```

## Примеры использования

### Вопрос о кормлении
```
Пользователь: "Как часто кормить щенка?"
AI: Использует информацию о весе и виде питомца для персонализированного ответа
```

### Вопрос о прививках
```
Пользователь: "Когда делать прививки моему питомцу?"
AI: Предлагает график прививок на основе вида и возраста питомца
```

### Предложение напоминания
```
Пользователь: "Нужно сделать прививку через неделю"
AI: Отвечает на вопрос + предлагает создать напоминание
```

