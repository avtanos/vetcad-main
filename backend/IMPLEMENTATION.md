# Описание реализации Backend API для VetCard

## Обзор

Реализован полнофункциональный backend API на FastAPI для приложения VetCard. API поддерживает все необходимые эндпоинты для работы фронтенда.

## Реализованные модули

### 1. Аутентификация и авторизация (`/api/v1/auth`)

- **POST /register/** - Регистрация нового пользователя
  - Создает пользователя и профиль
  - Возвращает данные профиля
  
- **POST /token/** - Получение JWT токенов (логин)
  - Возвращает access и refresh токены
  - Проверяет учетные данные пользователя
  
- **POST /token/refresh/** - Обновление access токена
  - Использует refresh токен для получения нового access токена
  
- **GET /get_profile/** - Получение профиля текущего пользователя
  - Требует авторизации
  - Возвращает полную информацию о профиле
  
- **PUT /profile/{profile_id}/** - Обновление профиля
  - Требует авторизации
  - Позволяет обновить данные профиля (включая специализацию для ветеринаров и данные для партнеров)

### 2. Управление питомцами (`/api/v1/pet`)

- **GET /** - Получение списка питомцев пользователя
  - Возвращает только питомцев текущего авторизованного пользователя
  
- **POST /** - Создание нового питомца
  - Принимает: name, birth_date, image_url, special_notes, type_of_animal, user
  - Автоматически связывает с текущим пользователем
  
- **PUT /{pet_id}/** - Обновление питомца
  - Позволяет обновить любые поля питомца
  
- **DELETE /{pet_id}/** - Удаление питомца
  - Удаляет питомца по ID (только свои питомцы)

### 3. Справочники (`/api/v1/reference`)

- **GET /ref_type_of_animal/** - Получение типов животных
  - Возвращает список всех типов животных (собака, кошка, птица и т.д.)
  - Публичный эндпоинт (не требует авторизации)
  
- **GET /ref_shop/** - Получение товаров
  - Возвращает список активных товаров
  - Публичный эндпоинт
  
- **POST /ref_shop/** - Создание товара
  - Требует авторизации
  - Позволяет партнерам создавать свои товары

### 4. Статьи (`/api/v1/parser`)

- **GET /articles/** - Получение статей
  - Возвращает список всех статей
  - Публичный эндпоинт (авторизация опциональна)
  - Включает информацию об авторе

### 5. Напоминания (`/api/v1/assistant`)

- **GET /reminder/** - Получение напоминаний пользователя
  - Возвращает все напоминания текущего пользователя
  - Требует авторизации
  
- **POST /reminder/** - Создание напоминания
  - Требует авторизации
  - Создает новое напоминание для пользователя

## Модели базы данных

### User (Пользователь)
- id, username, email, password_hash, is_active
- Связь один-к-одному с Profile

### Profile (Профиль)
- Основные поля: first_name, last_name, third_name, phone, city, address, logo, role
- Для ветеринаров: clinic, position, specialization, experience, license_number
- Для партнеров: name_of_organization, type, website, description

### Pet (Питомец)
- id, name, species (FK к TypeOfAnimal), breed, birth_date, weight, image_url, special_notes, user_id

### TypeOfAnimal (Тип животного)
- id, name_ru, name_kg, is_active

### RefShop (Товар)
- id, name_ru, name_kg, is_active, img_url, description, user_id

### Article (Статья)
- id, title, excerpt, image_url, category, published_date, author_name, author_avatar_url, source_url, content

### Reminder (Напоминание)
- id, user_id, animal_name, assistant_sms, date_assistant, status

## Безопасность

1. **JWT аутентификация**
   - Access токены с ограниченным временем жизни (30 минут)
   - Refresh токены для обновления (7 дней)
   - Токены содержат тип для различения access/refresh

2. **Хеширование паролей**
   - Используется bcrypt для безопасного хранения паролей
   - Пароли никогда не хранятся в открытом виде

3. **Авторизация**
   - Все защищенные эндпоинты требуют Bearer токен
   - Проверка прав доступа (пользователь может изменять только свои данные)

4. **CORS**
   - Настроен для работы с фронтендом
   - В продакшене нужно указать конкретные домены

## Конфигурация

Все настройки вынесены в переменные окружения (`.env`):
- `DATABASE_URL` - строка подключения к PostgreSQL
- `SECRET_KEY` - секретный ключ для JWT
- `ALGORITHM` - алгоритм шифрования (HS256)
- `ACCESS_TOKEN_EXPIRE_MINUTES` - время жизни access токена
- `REFRESH_TOKEN_EXPIRE_DAYS` - время жизни refresh токена

## Инициализация

Скрипт `app/init_db.py` создает:
- Все таблицы базы данных
- Начальные типы животных (10 типов)
- Примеры статей (опционально)

## Соответствие фронтенду

API полностью соответствует ожиданиям фронтенда:
- Все эндпоинты соответствуют URL, используемым во фронтенде
- Форматы запросов и ответов соответствуют TypeScript интерфейсам
- Обработка ошибок соответствует ожиданиям фронтенда
- JWT токены работают с механизмом refresh токенов фронтенда

## Дальнейшие улучшения

1. **Миграции базы данных**
   - Настроить Alembic для управления миграциями
   
2. **Валидация данных**
   - Добавить более строгую валидацию входных данных
   - Проверка формата email, длины пароля и т.д.

3. **Тестирование**
   - Добавить unit-тесты для всех эндпоинтов
   - Интеграционные тесты

4. **Оптимизация**
   - Добавить индексы в базу данных
   - Оптимизация запросов (eager loading где необходимо)

5. **Документация**
   - Более подробные описания эндпоинтов в Swagger
   - Примеры запросов и ответов

6. **Безопасность**
   - Rate limiting для защиты от DDoS
   - Валидация входных данных на уровне SQL (SQL injection protection)
   - HTTPS в продакшене

